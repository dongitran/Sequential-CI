<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Interactive Steps with JSON Viewer - antd@5.12.4</title>
    <style>
      body {
        background-color: #343541;
        overflow: hidden;
      }
      .main-title {
        font-size: 2em;
        flex-direction: column;
        align-items: center;
        text-align: center;
        font-weight: bold;
        color: azure;
      }
      .steps-container {
        display: flex;
        padding: 40px 90px;
        margin-bottom: 20px;
      }
      .steps {
        width: 300px;
        margin-right: 20px;
        max-height: 80vh;
        overflow-y: auto;
      }
      .json-viewer {
        flex: 1;
        border: 1px solid #ccc;
        padding: 10px;
        height: 80vh;
        background-color: rgb(24, 24, 24);
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="main-title" id="title"></div>
    <div class="steps-container">
      <div class="steps" id="steps"></div>
      <div class="json-viewer" id="json-viewer"></div>
    </div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/dayjs@1/dayjs.min.js"></script>
    <script src="https://unpkg.com/antd@5.12.4/dist/antd-with-locales.min.js"></script>
    <script src="https://unpkg.com/@ant-design/icons/dist/index.umd.js"></script>
    <script src="https://unpkg.com/react-router-dom/dist/umd/react-router-dom.production.min.js"></script>
    <script src="https://unpkg.com/react-router/dist/umd/react-router.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@textea/json-viewer@3"></script>

    <script>
      const { createRoot } = ReactDOM;
      const { Steps } = antd;
      const { useState, useEffect } = React;

      const App = () => {
        const [currentStep, setCurrentStep] = useState(0);
        const [stepsData, setStepsData] = useState([]);

        const url = window.location.pathname;
        const parts = url.split("/");
        const id = parts[parts.length - 1];

        useEffect(() => {
          const url = window.location.pathname;
          const parts = url.split("/");
          const id = parts[parts.length - 1];

          fetch(`/api/detail/${id}`)
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              return response.json();
            })
            .then((jsonData) => {
              document.getElementById("title").textContent =
                jsonData[0].processName;

              const jsonViewer = document.getElementById("json-viewer");
              let stepsDataTmp = jsonData[0].process.map((item) => {
                return {
                  title: "aadsfasfda",
                  description: item?.description,
                  data: item?.result,
                };
              });

              handleStepClick(stepsDataTmp, 0);
              setStepsData(stepsDataTmp);
            })
            .catch((error) => {
              console.error(
                "There was a problem with the fetch operation:",
                error
              );
            });
        }, []);

        const handleStepClick = (data, stepIndex) => {
          setCurrentStep(data.length - 1);
          const jsonViewer = document.getElementById("json-viewer");
          jsonViewer.textContent = renderJSON(data[stepIndex].data);
        };

        function renderJSON(data) {
          return new JsonViewer({
            value: data,
            theme: "dark",
            displayDataTypes: false,
          }).render("#json-viewer");
        }

        return React.createElement(
          Steps,
          {
            direction: "vertical",
            size: "small",
            current: currentStep,
            status: "finish",
            items: stepsData.map((step, index) => ({
              title: React.createElement(
                "span",
                {
                  style: {
                    color: "white",
                    fontSize: "14px",
                    cursor: "pointer",
                  },
                },
                step.description
              ),
              description: "",
              onClick: () => handleStepClick(stepsData, index),
            })),
          },
          null
        );
      };

      const mountNode = document.getElementById("steps");
      createRoot(mountNode).render(React.createElement(App));
    </script>
  </body>
</html>
